{% extends "base.html" %}
{% block title %}Registration Successful{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="columns is-centered">
            <div class="column is-8">

                <!-- SUCCESS HEADER -->
                <div class="box has-text-centered mb-5 no-print" style="border-top:4px solid #48c78e;">
                    <span class="icon is-large has-text-success">
                        <i class="fas fa-check-circle fa-3x"></i>
                    </span>

                    <h1 class="title mt-3">Registration Successful üéâ</h1>
                    <p class="subtitle">
                        Thank you, <strong>{{ registration.full_name }}</strong>
                    </p>

                    <span class="tag is-success is-light is-medium">
                        ID: {{ registration._id }}
                    </span>
                </div>

                <!-- RECEIPT -->
                <div class="card" id="receipt">
                    <header class="card-header">
                        <p class="card-header-title">üìÑ Registration Receipt</p>
                    </header>

                    <div class="card-content">
                        <div class="columns is-vcentered is-multiline">

                            <!-- DETAILS -->
                            <div class="column is-7">
                                <div class="content">
                                    <p><strong>Email:</strong> {{ registration.email }}</p>
                                    <p><strong>Segment:</strong> {{ registration.segment_name }}</p>
                                    <p><strong>Category:</strong> {{ registration.category }}</p>
                                    <p><strong>Institution:</strong> {{ registration.institution }}</p>

                                    {% if registration.ca_ref %}
                                    <p><strong>CA Reference:</strong> {{ registration.ca_ref }}</p>
                                    {% endif %}

                                    <p><strong>Transaction ID:</strong><br>
                                        <code>{{ registration.transaction_id }}</code>
                                    </p>
                                </div>
                                {% if registration.verified %}
                                <article class="message is-primary is-light mt-4">
                                    <div class="message-body">
                                        ‚è≥ Status: <strong>Registration verified</strong><br>
                                        Check your email. Don't forget to check your spam box.
                                    </div>
                                </article>
                                {% else %}
                                <article class="message is-warning is-light mt-4">
                                    <div class="message-body">
                                        ‚è≥ Status: <strong>Pending verification</strong><br>
                                        You will receive an email once approved.
                                    </div>
                                </article>
                                {% endif %}
                            </div>

                            <!-- QR -->
                            <div class="column is-5 has-text-centered">
                                <p class="has-text-weight-semibold mb-2">Scan for Verification</p>

                                <div class="is-flex is-justify-content-center">
                                    <div id="qrcode" class="mb-3"></div>
                                </div>

                                <p class="is-size-7 has-text-grey">Contains your registration ID</p>
                            </div>


                        </div>
                    </div>

                    <!-- ACTIONS -->
                    <footer class="card-footer no-print">
                        <a href="{{ url_for('index') }}" class="card-footer-item has-text-success">
                            üè† Home
                        </a>
                        <a href="{{ url_for('register') }}" class="card-footer-item has-text-link">
                            ‚ûï Register Another
                        </a>
                        <a onclick="window.print()" class="card-footer-item has-text-primary">
                            üñ® Download / Print PDF
                        </a>
                    </footer>
                </div>

            </div>
        </div>
    </div>
</section>

<!-- QR LIB -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
    /* PRINT STYLING */
    @media print {
        body {
            background: white;
        }

        .no-print {
            display: none !important;
        }

        #receipt {
            box-shadow: none;
            border: 1px solid #ddd;
        }

        .card-header {
            border-bottom: 2px solid #00d1b2;
        }
    }
</style>

<script>
    const regID = "{{ registration._id }}";

    new QRCode(document.getElementById("qrcode"), {
        text: regID,
        width: 160,
        height: 160
    });
</script>
{% endblock %}